# 目標コマンド単体テスト仕様書

## 概要

この文書では、タスク管理システムにおける目標コマンドの単体テストの仕様を定義します。
単体テストの目的は、各コマンドが正常に機能し、異常な入力に対して適切に対応することを確認することです。

## テスト環境

- テストでは一時的なインメモリSQLiteデータベースを使用します
- 各テストは独立して実行でき、他のテスト結果に依存しません
- 各テストの前後で適切なセットアップとクリーンアップが行われます

## テストケース

### 1. 目標一覧表示テスト (`test_list_command`)

**目的:** 目標一覧が正しく表示されることを確認する

**手順:**
1. テスト目標を複数作成
2. 目標一覧コマンドを実行
3. 出力結果をチェック

**検証項目:**
- コマンドが成功すること（終了コード0）
- すべてのテスト目標が一覧に表示されること
- 目標のタイトルが出力に含まれること

### 2. 目標詳細表示テスト (`test_show_command`)

**目的:** 特定の目標の詳細が正しく表示され、存在しない目標に対して適切なエラーが表示されることを確認する

**手順:**
1. 存在する目標IDに対して詳細表示コマンドを実行
2. 存在しない目標IDに対して詳細表示コマンドを実行

**検証項目:**
- 存在する目標の詳細表示が成功すること（終了コード0）
- 存在する目標の詳細に正しい情報が含まれること
- 存在しない目標の詳細表示が失敗すること（終了コード1）
- 存在しない目標の場合、適切なエラーメッセージが表示されること

### 3. 目標作成テスト (`test_create_command`)

**目的:** 新しい目標が正しく作成されることを確認する

**手順:**
1. 目標作成コマンドを実行（タイトル、説明、測定基準、目標値を指定）
2. 目標一覧コマンドを実行して作成結果を確認

**検証項目:**
- 目標作成コマンドが成功すること（終了コード0）
- 作成確認メッセージが適切に表示されること
- 作成した目標が一覧に表示されること

### 4. 目標更新テスト (`test_update_command`)

**目的:** 既存の目標情報が正しく更新されることを確認する

**手順:**
1. 更新対象目標を作成
2. 目標更新コマンドを実行（タイトル、説明を変更）
3. 更新後の詳細を表示して変更が反映されているか確認

**検証項目:**
- 目標更新コマンドが成功すること（終了コード0）
- 更新確認メッセージが適切に表示されること
- 更新後の詳細に変更内容が反映されていること

### 5. 目標ステータス変更テスト (`test_status_command`)

**目的:** 目標のステータスが正しく変更され、無効なステータスの場合は適切にエラーとなることを確認する

**手順:**
1. ステータス変更対象目標を作成
2. 有効なステータス値で変更コマンドを実行
3. 無効なステータス値で変更コマンドを実行

**検証項目:**
- 有効なステータス変更が成功すること（終了コード0）
- 変更確認メッセージが適切に表示されること
- 無効なステータス変更が失敗すること（終了コード1）
- 無効なステータスの場合、適切なエラーメッセージが表示されること

### 6. サブ目標作成テスト (`test_create_subobjective`)

**目的:** 親目標の下にサブ目標が正しく作成されることを確認する

**手順:**
1. 親目標を作成
2. 親目標の下にサブ目標を作成するコマンドを実行
3. 親目標の詳細を表示してサブ目標が関連付けられていることを確認

**検証項目:**
- サブ目標作成コマンドが成功すること（終了コード0）
- 作成確認メッセージが適切に表示されること
- 親目標の詳細表示に子目標情報が含まれること

### 7. 目標削除テスト (強制なし) (`test_delete_without_force`)

**目的:** 子目標がない場合に目標が正しく削除され、子目標がある場合は強制オプションなしでは削除できないことを確認する

**手順:**
1. テスト用目標を作成
2. 子目標がない目標を通常削除
3. 親目標の下に子目標を作成
4. 子目標を持つ親目標を強制オプションなしで削除を試みる

**検証項目:**
- 子目標がない場合、通常削除が成功すること（終了コード0）
- 子目標がある場合、強制オプションなしの削除が失敗すること（終了コード1）
- 失敗時に適切なエラーメッセージが表示されること

### 8. 目標削除テスト (強制あり) (`test_delete_with_force`)

**目的:** 強制オプションを使用することで子目標を持つ目標が正しく削除されることを確認する

**手順:**
1. 親目標を作成
2. 親目標の下に子目標を作成
3. 強制オプション付きで親目標を削除
4. 削除後に親目標と子目標が存在しないことを確認

**検証項目:**
- 強制削除コマンドが成功すること（終了コード0）
- 削除確認メッセージが適切に表示されること
- 削除後に目標の詳細表示がエラーとなること（見つからない）

## 実装の詳細

- 各テストは`CliRunner`を使用してコマンド実行をシミュレートします
- 出力からの検証には`assert`ステートメントを使用します
- テスト間の独立性を保つため、各テストで必要なセットアップを行います

## テスト対象ファイル

- 単体テスト実装: `tests/unit/test_objective_manual.py`
- テスト設定: `tests/conftest.py`, `tests/unit/conftest.py` 