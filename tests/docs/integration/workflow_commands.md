# ワークフロー管理コマンド結合テスト仕様

## 概要

ワークフロー管理コマンドの結合テストでは、以下の機能をテストします：

- データベースへのワークフロー情報の保存と取得
- ワークフローの作成、表示、更新、削除の一連の流れ
- ワークフローとプロセスの連携
- バリデーションエラーの処理

この結合テストでは実際のデータベースアクセスを伴う処理をテストし、コマンドの機能が想定通りに動作することを確認します。

## テスト環境

- 一時的なSQLiteデータベースを使用
- 各テスト実行時にデータベースを初期化
- conftest.pyによる共通セットアップの利用

## テストケース

### `test_create_and_list`

**目的**: ワークフローの作成と一覧表示の機能が正しく動作することを確認する

**手順**:
1. ワークフローを2件作成する
2. list コマンドで一覧を表示する

**期待される結果**:
- 作成コマンドの終了コード: 0
- 作成コマンドの出力に "ワークフローを作成しました" が含まれること
- 一覧表示コマンドの終了コード: 0
- 一覧に作成した2件のワークフローが含まれること
- ワークフローIDが表示されること
- ワークフロー名が表示されること

### `test_show_workflow`

**目的**: ワークフローの詳細表示機能が正しく動作することを確認する

**手順**:
1. ワークフローを作成する
2. show コマンドで詳細を表示する

**期待される結果**:
- 詳細表示コマンドの終了コード: 0
- 出力にワークフローIDが含まれること
- 出力にワークフロー名が含まれること
- 出力にワークフローの説明が含まれること
- 出力に作成日時が含まれること

### `test_add_process_to_workflow`

**目的**: ワークフローへのプロセス追加機能が正しく動作することを確認する

**手順**:
1. プロセスを2件作成する
2. ワークフローを作成する
3. add-process コマンドでワークフローにプロセスを追加する
4. show コマンドで確認する

**期待される結果**:
- プロセス追加コマンドの終了コード: 0
- プロセス追加コマンドの出力に "プロセスをワークフローに追加しました" が含まれること
- 詳細表示でワークフローに追加したプロセスが表示されること
- プロセスの順序が正しく表示されること

### `test_remove_process_from_workflow`

**目的**: ワークフローからのプロセス削除機能が正しく動作することを確認する

**手順**:
1. プロセスを作成する
2. ワークフローを作成する
3. プロセスをワークフローに追加する
4. remove-process コマンドでワークフローからプロセスを削除する
5. show コマンドで確認する

**期待される結果**:
- プロセス削除コマンドの終了コード: 0
- プロセス削除コマンドの出力に "プロセスをワークフローから削除しました" が含まれること
- 詳細表示で削除したプロセスがワークフローに含まれていないこと

### `test_update_workflow`

**目的**: ワークフローの更新機能が正しく動作することを確認する

**手順**:
1. ワークフローを作成する
2. update コマンドでワークフロー名と説明を更新する
3. show コマンドで更新されたことを確認する

**期待される結果**:
- 更新コマンドの終了コード: 0
- 更新コマンドの出力に "ワークフローを更新しました" が含まれること
- 詳細表示で更新後のワークフロー名が表示されること
- 詳細表示で更新後の説明が表示されること

### `test_simple_delete`

**目的**: ワークフローの削除機能が正しく動作することを確認する

**手順**:
1. ワークフローを作成する
2. delete コマンドでワークフローを削除する
3. list コマンドで削除されたことを確認する

**期待される結果**:
- 削除コマンドの終了コード: 0
- 削除コマンドの出力に "ワークフローを削除しました" が含まれること
- 一覧表示で削除したワークフローが表示されないこと

### `test_delete_with_force`

**目的**: ワークフローのforce削除機能が正しく動作することを確認する

**手順**:
1. ワークフローを作成する
2. プロセスを作成し、ワークフローに追加する
3. 通常の削除コマンドを実行する（失敗するはず）
4. --force オプション付きで削除コマンドを実行する
5. list コマンドで削除されたことを確認する

**期待される結果**:
- 通常削除コマンドの終了コード: 1
- 通常削除コマンドの出力に "ワークフローにプロセスが登録されているため削除できません" などのエラーメッセージが含まれること
- force削除コマンドの終了コード: 0
- force削除コマンドの出力に "ワークフローを強制削除しました" が含まれること
- 一覧表示で削除したワークフローが表示されないこと

### `test_error_handling`

**目的**: エラー処理が正しく機能することを確認する

**手順**:
1. 存在しないワークフローIDを指定して show コマンドを実行する
2. 存在しないワークフローIDを指定して update コマンドを実行する
3. 存在しないワークフローIDを指定して delete コマンドを実行する
4. 存在しないプロセスIDをワークフローに追加しようとする
5. ワークフローに含まれていないプロセスを削除しようとする

**期待される結果**:
- 各コマンドの終了コード: 1
- 適切なエラーメッセージが表示されること
  - "ワークフローが見つかりません"
  - "プロセスが見つかりません"
  - "指定されたプロセスはこのワークフローに含まれていません" 